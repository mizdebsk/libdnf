FIND_PACKAGE(PythonInstDir)
FIND_PACKAGE (SWIG REQUIRED)
INCLUDE (UseSWIG)

IF (NOT PYTHON_DESIRED)
    SET (PYTHON_DESIRED "3")
ENDIF ()

IF (${PYTHON_DESIRED} STREQUAL "2")
    MESSAGE ("Building for python2")
    FIND_PACKAGE (PythonInterp 2 REQUIRED)
    FIND_PACKAGE (PythonLibs 2 REQUIRED)
ELSEIF (${PYTHON_DESIRED} STREQUAL "3")
    MESSAGE ("Building for python3")
    FIND_PACKAGE (PythonInterp 3 REQUIRED)
    FIND_PACKAGE (PythonLibs 3 REQUIRED)
ELSE ()
    MESSAGE (FATAL_ERROR "Invalid PYTHON_DESIRED value: " ${PYTHON_DESIRED})
ENDIF ()


INCLUDE_DIRECTORIES (${CMAKE_SOURCE_DIR})
INCLUDE_DIRECTORIES (${PYTHON_INCLUDE_PATH})
INCLUDE (UseSWIG)

if(CMAKE_SIZEOF_VOID_P EQUAL 8)
    # using 64bit architecture
    SET(CMAKE_SWIG_FLAGS "-DSWIGWORDSIZE64")
endif ()

SET_SOURCE_FILES_PROPERTIES (../swig/utils.i PROPERTIES CPLUSPLUS ON)
SWIG_ADD_MODULE (utils python ../swig/utils.i)
SWIG_LINK_LIBRARIES (utils libdnf)
SWIG_LINK_LIBRARIES (utils ${PYTHON_LIBRARY})
SWIG_LINK_LIBRARIES (utils ${SQLite3_LIBRARIES})

SET_SOURCE_FILES_PROPERTIES (../swig/swdb.i PROPERTIES CPLUSPLUS ON)
SWIG_ADD_MODULE (swdb python ../swig/swdb.i)
SWIG_LINK_LIBRARIES (swdb libdnf)
SWIG_LINK_LIBRARIES (swdb ${PYTHON_LIBRARY})

configure_file(__init__.py ${CMAKE_CURRENT_BINARY_DIR}/__init__.py COPYONLY)

INSTALL (FILES __init__.py DESTINATION ${PYTHON_INSTALL_DIR}/libdnf)

INSTALL (TARGETS _swdb DESTINATION ${PYTHON_INSTALL_DIR}/libdnf)
INSTALL (FILES ${CMAKE_BINARY_DIR}/bindings/python/swdb.py DESTINATION ${PYTHON_INSTALL_DIR}/libdnf)

INSTALL (TARGETS _utils DESTINATION ${PYTHON_INSTALL_DIR}/libdnf)
INSTALL (FILES ${CMAKE_BINARY_DIR}/bindings/python/utils.py DESTINATION ${PYTHON_INSTALL_DIR}/libdnf)
